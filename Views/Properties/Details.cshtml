@model RealEstatePro.DTOs.Property.PropertyDto
@inject RealEstatePro.Services.ITranslationService TranslationService
@{
    ViewData["Title"] = Model.Title;
    var currentCulture = Context.Request.Cookies["Language"] ?? "en";
    var t = TranslationService.GetTranslations(currentCulture);
}

<div class="container" style="padding: 2rem 1.25rem 3rem;">
    <a asp-action="Index" class="btn btn-outline" style="margin-bottom: 2rem;">@t["back_to_list"]</a>
    
    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem;">
        <!-- Left Column: Details -->
        <div>
            <img src="@Model.ImageUrl" alt="@Model.Title" 
                 style="width: 100%; height: 400px; object-fit: cover; border-radius: var(--card-radius); margin-bottom: 2rem;" 
                 onerror="this.src='https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=800&h=600&fit=crop'" />
            
            <div class="glass-panel" style="margin-bottom: 2rem;">
                <h1 style="margin-bottom: 0.5rem;">@Model.Title</h1>
                <p class="text-muted" style="margin-bottom: 1rem;">üìç @Model.Location</p>
                
                <h2 style="color: var(--primary); margin-bottom: 2rem;">
                    @Model.Price.ToString("N0") @t["sar"]
                    @if (Model.PropertyType == "rent")
                    {
                        <span style="font-size: 1rem; font-weight: normal;">@t["per_year"]</span>
                    }
                </h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <strong>@t["bedrooms"]</strong>
                        <div class="stat-value">@Model.Bedrooms</div>
                    </div>
                    <div class="stat-card">
                        <strong>@t["bathrooms"]</strong>
                        <div class="stat-value">@Model.Bathrooms</div>
                    </div>
                    <div class="stat-card">
                        <strong>@t["area"]</strong>
                        <div class="stat-value">@Model.Area @t["sqm"]</div>
                    </div>
                    <div class="stat-card">
                        <strong>@t["property_type_label"]</strong>
                        <div class="stat-value" style="font-size: 1rem;">@t[Model.Category]</div>
                    </div>
                </div>
                
                <h3 style="margin-bottom: 0.75rem;">@t["description"]</h3>
                <p style="white-space: pre-line; color: var(--text-light); line-height: 1.8;">@Model.Description</p>
            </div>
            
            <!-- Interactive Map -->
            <div class="glass-panel">
                <h3 style="margin-bottom: 1rem;">üìç @t["location"]</h3>
                <div id="map" style="height: 350px; width: 100%; border-radius: 0.75rem; z-index: 1;"></div>
            </div>
        </div>
        
        <!-- Right Column: Contact Form -->
        <div>
            <div class="form-container" style="margin: 0; position: sticky; top: 6rem;">
                <h3 style="margin-bottom: 0.25rem;">@t["contact_owner"]</h3>
                <p class="text-muted" style="margin-bottom: 1.5rem;">@Model.OwnerName</p>
                
                <form asp-controller="Requests" asp-action="Create" method="post">
                    <input type="hidden" name="PropertyId" value="@Model.Id" />
                    
                    <div class="form-group">
                        <label class="form-label">@t["full_name"]</label>
                        <input name="Name" class="form-control" required />
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">@t["email"]</label>
                        <input name="Email" type="email" class="form-control" required />
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">@t["phone"]</label>
                        <input name="Phone" class="form-control" />
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">@t["message"]</label>
                        <textarea name="Message" class="form-control" rows="4"></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%;">@t["submit"]</button>
                    @Html.AntiForgeryToken()
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var lat = @Model.Latitude;
            var lng = @Model.Longitude;
            
            if (lat === 0 && lng === 0) {
                lat = 24.7136;
                lng = 46.6753;
            }

            var map = L.map('map').setView([lat, lng], 14);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map);

            L.marker([lat, lng]).addTo(map)
                .bindPopup('@Html.Raw(Model.Title.Replace("'", "\\'"))')
                .openPopup();
        });
    </script>
}
